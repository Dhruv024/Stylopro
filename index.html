<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stylo AI | Virtual Try-On</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #52525b; border-radius: 3px; }
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        .dark .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .loader {
            border: 2px solid rgba(255,255,255,0.1);
            border-left-color: currentColor;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        body, .glass-panel, nav, footer {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
    </style>
</head>
<body class="bg-zinc-50 text-zinc-600 dark:bg-[#050505] dark:text-zinc-400 antialiased selection:bg-emerald-500/20 selection:text-emerald-500 flex flex-col min-h-screen">

    <nav class="fixed top-0 w-full z-50 border-b border-black/5 dark:border-white/5 bg-white/80 dark:bg-[#050505]/80 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div onclick="navigateTo('home')" class="flex items-center gap-2 cursor-pointer group">
                    <div class="w-8 h-8 bg-black dark:bg-white rounded-lg flex items-center justify-center transition-transform group-hover:scale-95">
                        <iconify-icon icon="lucide:sparkles" class="text-white dark:text-black text-lg" stroke-width="1.5"></iconify-icon>
                    </div>
                    <span class="text-black dark:text-white font-semibold tracking-tight text-lg">Stylo.ai</span>
                </div>

                <div class="hidden md:flex items-center gap-8 text-sm font-medium">
                    <button onclick="navigateTo('home')" class="text-zinc-600 dark:text-zinc-400 hover:text-black dark:hover:text-white transition-colors">Home</button>
                    <button onclick="navigateTo('how-it-works')" class="text-zinc-600 dark:text-zinc-400 hover:text-black dark:hover:text-white transition-colors">How it works</button>
                    <button onclick="navigateTo('pricing')" class="text-zinc-600 dark:text-zinc-400 hover:text-black dark:hover:text-white transition-colors">Pricing</button>
                    <button onclick="navigateTo('contact')" class="text-zinc-600 dark:text-zinc-400 hover:text-black dark:hover:text-white transition-colors">Contact</button>
                </div>

                <div class="flex items-center gap-3">
                    <div class="relative">
                        <button onclick="toggleThemeMenu()" class="flex items-center justify-center w-8 h-8 rounded-full hover:bg-black/5 dark:hover:bg-white/10 text-zinc-600 dark:text-zinc-400 transition-colors">
                            <iconify-icon id="theme-icon" icon="lucide:moon" stroke-width="1.5"></iconify-icon>
                        </button>
                        <div id="theme-menu" class="hidden absolute right-0 mt-2 w-32 bg-white dark:bg-zinc-900 rounded-lg shadow-xl border border-black/5 dark:border-white/10 overflow-hidden z-50">
                            <button onclick="setTheme('light')" class="w-full text-left px-4 py-2 text-xs font-medium hover:bg-zinc-100 dark:hover:bg-zinc-800 flex items-center gap-2">
                                <iconify-icon icon="lucide:sun" stroke-width="1.5"></iconify-icon> Light
                            </button>
                            <button onclick="setTheme('dark')" class="w-full text-left px-4 py-2 text-xs font-medium hover:bg-zinc-100 dark:hover:bg-zinc-800 flex items-center gap-2">
                                <iconify-icon icon="lucide:moon" stroke-width="1.5"></iconify-icon> Dark
                            </button>
                            <button onclick="setTheme('system')" class="w-full text-left px-4 py-2 text-xs font-medium hover:bg-zinc-100 dark:hover:bg-zinc-800 flex items-center gap-2">
                                <iconify-icon icon="lucide:monitor" stroke-width="1.5"></iconify-icon> System
                            </button>
                        </div>
                    </div>

                    <div class="h-4 w-[1px] bg-zinc-300 dark:bg-zinc-800 mx-1"></div>

                    <div id="auth-logged-out" class="hidden md:flex items-center gap-3">
                        <button onclick="openAuthModal('login')" class="text-sm font-medium text-zinc-600 dark:text-zinc-300 hover:text-black dark:hover:text-white transition-colors">Log in</button>
                        <button onclick="openAuthModal('signup')" class="bg-black dark:bg-white text-white dark:text-black text-sm font-medium px-4 py-2 rounded-full hover:opacity-90 transition-all">Sign up</button>
                    </div>

                    <div id="auth-logged-in" class="hidden items-center gap-3">
                        <div class="flex flex-col items-end mr-1">
                            <span id="user-display-email" class="text-xs font-medium text-black dark:text-white">user@example.com</span>
                            <span class="text-[10px] text-zinc-500 uppercase tracking-wider">Free Plan</span>
                        </div>
                        <button onclick="logout()" class="w-8 h-8 rounded-full bg-emerald-500 text-white flex items-center justify-center font-bold text-xs" title="Logout">
                            <iconify-icon icon="lucide:log-out" stroke-width="1.5"></iconify-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main id="app-content" class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto flex-grow w-full">
        <div id="page-home" class="page-section animate-fade-in">
            <div class="text-center max-w-3xl mx-auto mb-16 pt-8">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-black/5 dark:border-white/10 bg-zinc-100 dark:bg-white/5 text-xs font-medium text-zinc-900 dark:text-white mb-6 animate-slide-up">
                    <span class="relative flex h-2 w-2">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                    </span>
                    AI V2.0 Powered by Gemini
                </div>
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-semibold text-black dark:text-white tracking-tight mb-6 animate-slide-up">
                    Redefine your style with <br/> intelligent fashion.
                </h1>
                <p class="text-lg text-zinc-600 dark:text-zinc-500 max-w-xl mx-auto leading-relaxed animate-slide-up">
                    Upload your photo, choose the occasion, and let Gemini replace your clothes while keeping your face and pose exactly the same.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 animate-slide-up mb-32">
                <div class="lg:col-span-4 space-y-4">
                    <div class="glass-panel rounded-2xl p-6 h-full flex flex-col justify-between shadow-sm">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-xs font-semibold text-zinc-500 dark:text-zinc-400 mb-2 uppercase tracking-wide">1. Select Gender</label>
                                <div class="grid grid-cols-2 gap-2 p-1 bg-zinc-100 dark:bg-zinc-900/50 rounded-lg border border-black/5 dark:border-white/5">
                                    <button onclick="selectGender('male')" id="btn-male" class="flex items-center justify-center gap-2 py-2.5 rounded-md text-sm font-medium transition-all bg-black dark:bg-zinc-800 text-white shadow-sm ring-1 ring-black/5 dark:ring-white/10">
                                        <iconify-icon icon="lucide:user" stroke-width="1.5"></iconify-icon> Male
                                    </button>
                                    <button onclick="selectGender('female')" id="btn-female" class="flex items-center justify-center gap-2 py-2.5 rounded-md text-sm font-medium transition-all text-zinc-500 hover:text-zinc-800 dark:hover:text-zinc-300">
                                        <iconify-icon icon="lucide:user-circle" stroke-width="1.5"></iconify-icon> Female
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-semibold text-zinc-500 dark:text-zinc-400 mb-2 uppercase tracking-wide">2. Occasion</label>
                                <div class="relative">
                                    <select id="occasion-select" class="w-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-white/10 text-black dark:text-white text-sm rounded-lg focus:ring-1 focus:ring-black/20 dark:focus:ring-white/30 focus:border-black/20 dark:focus:border-white/30 block w-full p-3 transition-colors outline-none cursor-pointer">
                                        <option value="casual attire">Casual Day Out</option>
                                        <option value="business suit">Business Professional</option>
                                        <option value="evening party dress">Evening Party</option>
                                        <option value="gym sportswear">Gym / Athleisure</option>
                                        <option value="winter coat and scarf">Winter Outfit</option>
                                        <option value="wedding guest outfit">Wedding Guest</option>
                                        <option value="elegant date night outfit">Date Night</option>
                                        <option value="summer beach wear">Summer Beach</option>
                                        <option value="festival bohemian style">Music Festival</option>
                                        <option value="airport travel comfort">Airport Comfort</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-zinc-500">
                                        <iconify-icon icon="lucide:chevron-down" stroke-width="1.5"></iconify-icon>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-semibold text-zinc-500 dark:text-zinc-400 mb-2 uppercase tracking-wide">3. Your Photo</label>
                                <div id="dropzone" class="relative group cursor-pointer">
                                    <input type="file" id="file-upload" class="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer" accept="image/*">
                                    <div class="border border-dashed border-zinc-300 dark:border-white/15 rounded-xl p-8 bg-zinc-50/50 dark:bg-zinc-900/20 group-hover:bg-zinc-100 dark:group-hover:bg-zinc-900/40 group-hover:border-zinc-400 dark:group-hover:border-white/30 transition-all text-center">
                                        <div id="upload-placeholder">
                                            <div class="w-10 h-10 bg-zinc-200 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                                                <iconify-icon icon="lucide:upload-cloud" class="text-zinc-500 dark:text-zinc-400 text-lg" stroke-width="1.5"></iconify-icon>
                                            </div>
                                            <p class="text-sm text-zinc-700 dark:text-zinc-300 font-medium">Click to upload</p>
                                            <p class="text-xs text-zinc-500 mt-1">JPG, PNG up to 5MB</p>
                                        </div>
                                        <div id="upload-success" class="hidden flex items-center justify-center gap-2">
                                            <iconify-icon icon="lucide:check-circle" class="text-emerald-500" stroke-width="1.5"></iconify-icon>
                                            <span class="text-sm text-black dark:text-white" id="filename">photo.jpg</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8">
                            <button onclick="generateOutfit()" id="generate-btn" class="w-full group relative overflow-hidden rounded-lg bg-black dark:bg-white p-3 text-sm font-medium text-white dark:text-black transition-all hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="relative z-10 flex items-center justify-center gap-2">
                                    <iconify-icon icon="lucide:wand-2" id="wand-icon" class="group-hover:rotate-12 transition-transform" stroke-width="1.5"></iconify-icon>
                                    Generate Outfit
                                </span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-8 min-h-[600px] lg:h-auto">
                    <div class="glass-panel rounded-2xl h-full relative overflow-hidden flex items-center justify-center shadow-sm">
                        <div class="absolute inset-0 z-0 opacity-[0.03] dark:opacity-20 pointer-events-none" style="background-image: radial-gradient(currentColor 1px, transparent 1px); background-size: 24px 24px;"></div>

                        <div id="empty-state" class="text-center z-10">
                            <div class="w-16 h-16 bg-zinc-100 dark:bg-white/5 rounded-2xl border border-black/5 dark:border-white/10 flex items-center justify-center mx-auto mb-4 backdrop-blur-sm shadow-xl">
                                <iconify-icon icon="lucide:image" class="text-zinc-400 dark:text-zinc-500 text-3xl" stroke-width="1.5"></iconify-icon>
                            </div>
                            <p class="text-zinc-500 dark:text-zinc-400 font-medium">No image generated yet</p>
                            <p class="text-zinc-400 dark:text-zinc-600 text-sm mt-1">Upload a photo to get started</p>
                        </div>

                        <img id="user-preview" src="" alt="User Upload" class="hidden absolute inset-0 w-full h-full object-cover z-10 opacity-30 blur-sm scale-105 transition-all duration-700">

                        <div id="result-container" class="hidden absolute inset-0 z-20 w-full h-full bg-zinc-900">
                            <img id="result-image" src="" class="w-full h-full object-cover transition-opacity duration-1000">
                            
                            <div class="absolute bottom-6 right-6 flex gap-2">
                                <button onclick="downloadResult()" class="bg-black/50 hover:bg-black/70 backdrop-blur-md text-white border border-white/10 p-2.5 rounded-lg transition-colors">
                                    <iconify-icon icon="lucide:download" stroke-width="1.5"></iconify-icon>
                                </button>
                                <button class="bg-white text-black p-2.5 px-4 rounded-lg font-medium text-sm hover:bg-zinc-200 transition-colors">
                                    Shop Look
                                </button>
                            </div>
                            
                            <div class="absolute top-6 left-6 flex items-center gap-2 bg-black/40 backdrop-blur-md border border-white/10 px-3 py-1.5 rounded-full">
                                <iconify-icon icon="lucide:sparkles" class="text-emerald-400 text-xs"></iconify-icon>
                                <span class="text-xs text-white font-medium">AI Tailored</span>
                            </div>
                        </div>

                        <div id="loader-overlay" class="hidden absolute inset-0 z-30 bg-white/80 dark:bg-black/80 backdrop-blur-md flex flex-col items-center justify-center text-center px-4">
                            <div class="loader mb-4 text-emerald-500"></div>
                            <p id="loader-text" class="text-zinc-800 dark:text-white text-sm font-medium animate-pulse">Analyzing body features...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Other pages hidden for routing demo -->
        <div id="page-how-it-works" class="page-section hidden">...</div>
        <div id="page-pricing" class="page-section hidden">...</div>
        <div id="page-contact" class="page-section hidden">...</div>
    </main>

    <footer class="border-t border-black/5 dark:border-white/5 bg-white dark:bg-[#020202] py-12 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <span class="text-zinc-500 text-xs">Â© 2023 Stylo AI. Powered by Gemini 2.5 Flash Image.</span>
        </div>
    </footer>

    <!-- Auth Modal & Other Logic -->
    <div id="auth-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeAuthModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="bg-white dark:bg-[#09090b] rounded-2xl border border-black/5 dark:border-white/10 shadow-2xl p-8">
                <h3 class="text-xl font-semibold text-black dark:text-white mb-6">Welcome to Stylo</h3>
                <form onsubmit="handleAuth(event)" class="space-y-4">
                    <input type="email" id="auth-email" placeholder="Email" class="w-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-white/10 rounded-lg p-3 text-sm outline-none text-black dark:text-white">
                    <input type="password" id="auth-pass" placeholder="Password" class="w-full bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-white/10 rounded-lg p-3 text-sm outline-none text-black dark:text-white">
                    <button class="w-full bg-black dark:bg-white text-white dark:text-black font-medium py-3 rounded-lg">Continue</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // API CONFIG
        const apiKey = ""; // Runtime provided
        const AI_MODEL = "gemini-2.5-flash-image-preview";

        let selectedGender = 'male';
        let fileUploaded = false;
        let base64Image = null;
        let currentUser = localStorage.getItem('stylo_current_user');

        function toggleThemeMenu() { document.getElementById('theme-menu').classList.toggle('hidden'); }
        function setTheme(theme) {
            const html = document.documentElement;
            if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                html.classList.add('dark');
                document.getElementById('theme-icon').setAttribute('icon', 'lucide:moon');
            } else {
                html.classList.remove('dark');
                document.getElementById('theme-icon').setAttribute('icon', 'lucide:sun');
            }
            document.getElementById('theme-menu').classList.add('hidden');
        }

        function navigateTo(p) { 
            document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById('page-' + p);
            if(target) target.classList.remove('hidden');
        }

        function openAuthModal() { document.getElementById('auth-modal').classList.remove('hidden'); }
        function closeAuthModal() { document.getElementById('auth-modal').classList.add('hidden'); }
        function handleAuth(e) {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            localStorage.setItem('stylo_current_user', email);
            currentUser = email;
            updateAuthUI();
            closeAuthModal();
        }
        function updateAuthUI() {
            document.getElementById('auth-logged-out').style.display = currentUser ? 'none' : 'flex';
            document.getElementById('auth-logged-in').style.display = currentUser ? 'flex' : 'none';
            if(currentUser) document.getElementById('user-display-email').textContent = currentUser;
        }
        function logout() { localStorage.removeItem('stylo_current_user'); currentUser = null; updateAuthUI(); }
        updateAuthUI();

        function selectGender(g) {
            selectedGender = g;
            document.getElementById('btn-male').className = g === 'male' ? "flex items-center justify-center gap-2 py-2.5 rounded-md text-sm font-medium transition-all bg-black dark:bg-zinc-800 text-white" : "flex items-center justify-center gap-2 py-2.5 rounded-md text-sm font-medium transition-all text-zinc-500";
            document.getElementById('btn-female').className = g === 'female' ? "flex items-center justify-center gap-2 py-2.5 rounded-md text-sm font-medium transition-all bg-black dark:bg-zinc-800 text-white" : "flex items-center justify-center gap-2 py-2.5 rounded-md text-sm font-medium transition-all text-zinc-500";
        }

        const fileInput = document.getElementById('file-upload');
        fileInput.addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    base64Image = ev.target.result.split(',')[1];
                    document.getElementById('user-preview').src = ev.target.result;
                    document.getElementById('user-preview').classList.remove('hidden');
                    document.getElementById('empty-state').classList.add('hidden');
                    document.getElementById('upload-placeholder').classList.add('hidden');
                    document.getElementById('upload-success').classList.remove('hidden');
                    document.getElementById('filename').textContent = e.target.files[0].name;
                    fileUploaded = true;
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    if (response.status !== 429 && response.status < 500) break;
                } catch (e) {}
                await new Promise(res => setTimeout(res, Math.pow(2, i) * 1000));
            }
            throw new Error("API Connection Failed");
        }

        async function generateOutfit() {
            if (!currentUser) return openAuthModal();
            if (!fileUploaded) return alert("Upload a photo first!");

            const occasion = document.getElementById('occasion-select').value;
            const loader = document.getElementById('loader-overlay');
            const loaderText = document.getElementById('loader-text');
            const resultImg = document.getElementById('result-image');
            const resultContainer = document.getElementById('result-container');
            const genBtn = document.getElementById('generate-btn');

            loader.classList.remove('hidden');
            resultContainer.classList.add('hidden');
            genBtn.disabled = true;

            const prompt = `This is a photo of a ${selectedGender}. Please change their clothes to a stylish ${occasion}. 
            CRITICAL RULES:
            1. Keep the person's face EXACTLY the same.
            2. Keep the person's body shape and pose EXACTLY the same.
            3. Keep the background and lighting EXACTLY the same.
            4. ONLY replace the clothing items (shirt, pants, dress, etc.) to match the style: ${occasion}.
            5. Ensure high-quality fabric textures and realistic shadows.`;

            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: "image/png", data: base64Image } }
                    ]
                }],
                generationConfig: { responseModalities: ["IMAGE"] }
            };

            const loaderMessages = [
                "Mapping body contours...",
                "Selecting fabrics...",
                "Applying AI tailoring...",
                "Finalizing look..."
            ];

            let msgIdx = 0;
            const msgInterval = setInterval(() => {
                loaderText.textContent = loaderMessages[msgIdx % loaderMessages.length];
                msgIdx++;
            }, 2000);

            try {
                const response = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/${AI_MODEL}:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    }
                );

                const data = await response.json();
                const outputPart = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData);
                
                if (outputPart) {
                    resultImg.src = `data:image/png;base64,${outputPart.inlineData.data}`;
                    resultImg.onload = () => {
                        loader.classList.add('hidden');
                        resultContainer.classList.remove('hidden');
                        resultImg.style.opacity = '1';
                    };
                } else {
                    throw new Error("No image returned");
                }

            } catch (err) {
                console.error(err);
                alert("The AI stylist is busy right now. Please try again in a moment.");
                loader.classList.add('hidden');
            } finally {
                clearInterval(msgInterval);
                genBtn.disabled = false;
            }
        }

        function downloadResult() {
            const link = document.createElement('a');
            link.href = document.getElementById('result-image').src;
            link.download = 'stylo-outfit.png';
            link.click();
        }
    </script>
</body>
</html>
